name: Ubuntu 22.04 Kernel Version Check

on:
  workflow_dispatch:  # 仅支持手动触发，避免频繁执行

jobs:
  check:
    runs-on: ubuntu-22.04  # 明确指定 Ubuntu 22.04 环境

    steps:
      - name: 1. 查看初始系统信息（内核+版本）
        run: |
          echo "===== 初始系统信息 ====="
          echo "内核版本:"
          uname -a  # 输出完整内核版本及系统信息
          echo "Ubuntu 版本:"
          lsb_release -a  # 输出 Ubuntu 具体版本
          echo "系统更新状态:"
          apt list --upgradable 2>/dev/null || echo "无可升级包"
          echo "======================"

      - name: 2. 启用仓库并更新软件包列表
        run: |
          sudo add-apt-repository universe -y  # 启用 universe 仓库（包含 libxattr-dev 等依赖）
          sudo apt-get update -y  # 更新软件包索引

      - name: 3. 安装编译依赖（可选，仅验证依赖安装是否影响内核）
        run: |
          echo "===== 安装关键编译依赖 ====="
          sudo apt-get install -y --no-install-recommends \
            build-essential \
            libxattr-dev \  # 之前缺失的关键依赖
            libcurl4-openssl-dev \  # 网络库依赖
            libncurses5-dev \  # 终端界面库
            python3  # Python 环境
          echo "======================"

      - name: 4. 系统升级（可选，验证内核是否会被自动升级）
        run: |
          echo "===== 执行系统升级（含内核更新） ====="
          sudo apt-get upgrade -y  # 升级所有可升级的软件包（包括内核）
          echo "======================"

      - name: 5. 再次查看系统信息（内核+版本）
        run: |
          echo "===== 升级后的系统信息 ====="
          echo "内核版本:"
          uname -a  # 查看内核是否因升级而变化
          echo "Ubuntu 版本:"
          lsb_release -a  # 确认 Ubuntu 版本是否仍为 22.04.x
          echo "======================"

      - name: 6. 上传完整日志
        uses: actions/upload-artifact@v4
        with:
          name: kernel-version-comparison
          path: /home/runner/work/_temp/*  # 可将步骤输出重定向到文件后上传
          retention-days: 7
    
